<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>회원가입</title>
</head>

<body>
    <table>
        <!-- 기본 정보 -->
        <tr>
            <td class="q2">아이디:</td>
            <td><input type="text" id="id" placeholder="4~12자의 영문 대소문자와 숫자로만 입력"></td>
        </tr>
        <tr>
            <td class="q2">비밀번호:</td>
            <td><input type="password" id="passwd" placeholder="4~12자의 영문 대소문자와 숫자로만 입력"></td>
        </tr>
        <tr>
            <td class="q2">비밀번호확인:</td>
            <td><input type="password" id="passwdcheck" placeholder="4~12자의 영문 대소문자와 숫자로만 입력"></td>
        </tr>
        <tr>
            <td class="q2">이메일:</td>
            <td><input type="text" id="email" placeholder="예) id@domain.com"></td>
        </tr>
        <tr>
            <td class="q2">이름:</td>
            <td><input type="text" id="name" placeholder="이름을 입력하세요"></td>
        </tr>
        <tr>
            <td class="q2">전화번호:</td>
            <td><input type="text" id="phone" placeholder="예) 010-1234-5678"></td>
        </tr>
        <!-- 프로필 이미지 추가 -->
        <tr>
            <td class="q2">프로필 이미지:</td>
            <td><input type="file" id="profilePic" accept="image/*" onchange="previewImage(event)"></td>
        </tr>
        <!-- 이미지 미리보기 -->
        <tr>
            <td colspan="2" style="text-align: center;">
                <img id="preview" src="#" alt="이미지 미리보기" style="display: none; max-width: 100px; height: auto;">
            </td>
        </tr>
    </table>

    <div>
        <input type="button" value="회원 가입" onclick="join()">
        <input type="button" value="로그인" onclick="login()">
    </div>
    <script src="../lib/jquery3.7.1.js"></script>
    <script>





        // 이미지 미리보기 기능
        function previewImage(event) {
            const reader = new FileReader();
            const preview = document.getElementById('preview');

            reader.onload = function () {
                preview.src = reader.result;
                preview.style.display = 'block';  // 이미지가 보이게 설정
            };

            reader.readAsDataURL(event.target.files[0]);
        }


        /*───────────────────────────────────────────────────────────────────────────────────────────*/





        /*회원가입 버튼*/
        function join() {
            let id = document.getElementById('id').value;
            let paw = document.getElementById('passwd').value;
            let paw2 = document.getElementById('passwdcheck').value
            let ema = document.getElementById('email').value;
            let name = document.getElementById('name').value;
            let phone = document.getElementById('phone').value;







            /*유효성검사부분*/
            const idEng = /^[a-zA-Z0-9]+$/;
            if (id == "" || id.length < 4 || id.length > 12 || !idEng.test(id)) {
                alert("아이디를 4~12자의 영문 대소문자와 숫자로만 입력해주세요.");
                document.getElementById('id').value = '';
                document.getElementById('id').focus();
                return;
            }


            /*이메일 유효성검사*/
            const em = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (ema == "" || !em.test(ema)) {
                alert("이메일형식으로 다시 입력해주세요.");
                document.getElementById('email').value = '';
                document.getElementById('email').focus();
                return;
            }

            /*이름 유효성 검사*/
            if (name == "" || name.length < 2) {
                alert("이름을 2글자 이상 입력해주세요.");
                document.getElementById('name').value = '';
                document.getElementById('name').focus();
                return;
            }
            /*전화번호 유효성검사*/
            const phonecheck = /^[0-9]+$/;
            if (phone == "" || !phonecheck.test(phone)) {
                alert("전화번호 형식으로 적어주세요");
                document.getElementById('phone').value = '';
                document.getElementById('phone').focus();
                return;
            }



        /*───────────────────────────────────────────────────────────────────────────────────────────*/


            /*비밀번호 유효성 검사*/
            const pwEng = /^[a-zA-Z0-9]+$/;
            if (paw == "" || paw.length < 4 || paw.length > 12 || !pwEng.test(paw)) {
                alert("비밀번호를 4~12자의 영문 대소문자와 숫자로만 입력해주세요.");
                document.getElementById('passwd').value = '';
                document.getElementById('passwdcheck').value = '';
                document.getElementById('passwd').focus();
                return;
            }
            /*비밀번호 아이디 중복제거*/
            if (id == paw) {
                alert("아이디와 비밀번호를 다르게 입력해주세요");
                document.getElementById('id').value = '';
                document.getElementById('passwd').value = '';
                document.getElementById('passwdcheck').value = '';
                document.getElementById('id').focus();
                return;
            }
            /*검사2*/
            else if (paw != paw2) {
                alert("비밀번호와 다르게 입력하셨습니다");
                document.getElementById('passwdcheck').value = '';
                document.getElementById('passwdcheck').focus();
                return;
            }


            /*───────────────────────────────────────────────────────────────────────────────────────────*/




            /*ajax서버로 보내서 추가하는 부분*/
            let profilePicInput = document.getElementById('profilePic');
            let profilePic = profilePicInput.files[0];

            let formData = new FormData();  // FormData로 데이터를 전송
            formData.append('id', id);
            formData.append('paw', paw);
            formData.append('ema', ema);
            formData.append('name', name);
            formData.append('phone', phone);

            // 이미지가 선택되지 않으면 기본 이미지로 설정
            if (profilePic) {
                formData.append('profilePic', profilePic);
            } else {
                formData.append('profilePic', null);  // 기본 이미지 설정
            }

            // 비동기 (AJAX) 요청으로 서버에 회원 정보 전송
            $.ajax({
                url: 'http://localhost:3000/join',
                type: 'POST',
                data: formData,  // FormData 전송
                contentType: false,
                processData: false,
                success: function (res) {
                    if (res.status === 200) {
                        alert('회원가입 성공!');
                        resetForm();
                        location.href = '#.html';  // 로그인 페이지로 이동
                    } else if (res.status === 409) {
                        alert('이미 존재하는 아이디입니다.');
                    }
                },
                error: function () {
                    alert('회원가입 처리 중 오류가 발생했습니다.');
                }
            });
        }

        /*───────────────────────────────────────────────────────────────────────────────────────────*/


        //초기화
        function resetForm() {
            document.getElementById('id').value = '';
            document.getElementById('passwd').value = '';
            document.getElementById('passwdcheck').value = '';
            document.getElementById('email').value = '';
            document.getElementById('name').value = '';
            document.getElementById('phone').value = '';
            document.getElementById('profilePic').value = '';
        }

        /*───────────────────────────────────────────────────────────────────────────────────────────*/

        // 로그인 페이지로 이동
        function login() {
            location.href = 'login.html';
        }

        /*───────────────────────────────────────────────────────────────────────────────────────────*/
    </script>
</body>

</html>